Веб тестирование выходит за рамки [A/B-тестирования](https://github.com/sutourisu/Practical-statistic/blob/main/%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5%20%D1%8D%D0%BA%D1%81%D0%BF%D0%B5%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D1%82%D1%8B%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0%20%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8/AB-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5.md) и проверяет сразу несколько вариантов эксперимента. Проверку на основе статистики *хи-квадрат* используют с количественными данными, чтобы проверить, насколько хорошо они укладываются в ожидаемое распределение. В статистической практике широко принято использовать статистику хи-квадрат вместе с таблицами сопряженности $r$ x $c$, чтобы определить, является ли разумной нулевая гипотеза о независимости среди переменных.

**Ключевые термины для проверки на основе статистики хи-квадрат:**

* **Статистика хи-квадрат (chi-square statistic)** - метрика, измеряющая степень, с которой наблюдаемые данные отступают от ожидания.
* **Ожидание или ожидаемое (expection or expected)** - поведение данных, по нашим ожиданиям, в условиях некоего допущения, как правило, нулевой гипотезы.

### Проверка хи-квадрат: подход на основе повторного отбора

Предположим, что вы тестируете три разных заголовка объявления - A, B и C, причем каждый из них - на 1000 посетителях.

<img src="https://i.imgur.com/cIRTR1j.png">

Заголовки, без всякого сомнения, выглядят разными. Заголовок A дает почти в два раза больше нажатий, чем заголовок B. Правда, фактические числа небольшие. Процедура [повторного отбора](https://github.com/sutourisu/Practical-statistic/blob/main/%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5%20%D1%8D%D0%BA%D1%81%D0%BF%D0%B5%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D1%82%D1%8B%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0%20%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8/%D0%9F%D0%BE%D0%B2%D1%82%D0%BE%D1%80%D0%BD%D1%8B%D0%B9%20%D0%BE%D1%82%D0%B1%D0%BE%D1%80.md) может поверить, отличается ли процент нажатий в еще большей степени, чем может быть вызвано случайностью. Для такой проверки мы должны распологать "ожидаемым" распределением нажатий, и в этом случае проверка будет осуществляться на основе допущения нулевой гипотезы о том, что всем трем заголовкам присущ один и тот же процент нажатий при совокупном проценте нажатий, равно 34/3000. В условиях этого допущения наша таблица сопряженности будет выглядеть так:

<img src="https://i.imgur.com/aTsvHjD.png">

*Остаток Пирсона* задается формулой:
$$R=\frac{наблюдаемое-ожидаемое}{\sqrt{ожидаемое}}$$
и показывает, насколько фактические количества отличаются от их ожидаемых количеств:

<img src="https://i.imgur.com/3w4vblA.png">

Статистика хи-квадрат задается как сумма квадратичных пирсоновских остатков:
$$\chi^2 = \sum\limits_{i}^{r}\sum\limits_{j}^{c}R^2$$
где $r$ и $c$ - это соответственно число строк и столбцов. Статистика хи-квадрат для данного примера составит 1,666. Действительно ли это больше, чем может разумно произойти в случайно модели?

Мы можем проверить это при помощи следующего ниже алгоритма повторного отбора:

1. Положить в коробку 34 единиц (нажатия) и 2966 нулей (нажатия отсутствуют).
2. Перетасовать, извлечь три отдельные выборки по 1000 элементов и подсчитать нажатия в каждом.
3. Найти квадратичные разницы между перетасованными количествами и ожидаемыми количествами и их просуммировать.
4. Повторить шаги 2 и 3, скажем, 1000 раз.
5. Как часто повторно отобранная сумма квадратичных отклонений превышает наблюдаемые? Этот показатель будет $p$-значением.


### Проверка хи-квадрат: статистическая теория

Асимптотическая статистическая теория показывает, что распределение статистики хи-квадрат может быть аппроксимировано *распределением хи-квадрат*. Надлежащее стандартное распределение определяется [степенями свободы](https://github.com/sutourisu/Practical-statistic/blob/main/%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5%20%D1%8D%D0%BA%D1%81%D0%BF%D0%B5%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D1%82%D1%8B%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0%20%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8/%D0%A1%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D0%B8%20%D1%81%D0%B2%D0%BE%D0%B1%D0%BE%D0%B4%D1%8B.md). Для таблицы сопряженности степени свободы связаны числом строк ($r$) и столбцов ($c$) следующим образом:
$$степени~свободы=(r-1)(c-1)$$
Распределение хи-квадрат в типичной ситуации имеет асимметричный вид, длинный хвост которого скошен вправо. Чем дальше на распределении находится наблюдаемая статистика, тем ниже $p$-значение.

<img src="https://i.imgur.com/KEVHCLe.png">

### Точный тест Фишера

Распределение хи-квадрат является хорошей аппроксимацией только описаной проверки на основе перетасованного отбора, кроме тех случаев, когда количества являются чрезвычайно низкими (однозначными, в особенности пять или меньше). В таких случаях процедура на основе повторного отбора будет давать более точные $p$-значения. На деле в большинстве статистических вычислительных перестановок, которые могут произойти, сводит в таблицу их частоты и точно определяет, насколько предельным является наблюдаемый результат. Эта процедура называется *точным тестом Фишера*.

### Релевантность для науки о данных

Проверка хи-квадрат или точные тест Фишера используют, когда вы хотите знать о том, является ли эффеккт реальным, или же он может быть продуктом случайности. В большинстве стандартных применений проверки хи-квадрат ее роль заключается в установлении статистической значимости, что в типичной ситуации необходимо до того, как исследование или эксперимент могут быть опубликованы. Это не особо ваажно для науки даных.

**Ключевые идеи для проверки хи-квадрат:**

* Общепринятая процедура в статистике состоит в проверке, согласуются ли наблюдаемые количества данных с допущением о независимости (например, склонность покупать ту или иную вещь не зависит от пола).
* Распределение хи-квадрат - это эталонное распределение (которое воплощает допущение о независимости), с которым должны быть сопоставлена наблюдаемая расчетная статистика хи-квадрат.
